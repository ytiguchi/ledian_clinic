globalThis.process ??= {}; globalThis.process.env ??= {};
import { e as createComponent, f as createAstro, r as renderTemplate, n as defineScriptVars, k as renderComponent, m as maybeRenderHead } from '../../../chunks/astro/server_BRXg5whf.mjs';
import { $ as $$Layout } from '../../../chunks/Layout_Dlq7WWaF.mjs';
export { renderers } from '../../../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const prerender = false;
const $$Edit = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Edit;
  const id = Astro2.params.id;
  return renderTemplate(_a || (_a = __template(["", " <script>(function(){", "\n  let categories: Array<{ id: string; name: string }> = [];\n  let subcategories: Array<{ id: string; name: string; category_id: string }> = [];\n  let treatments: Array<{ id: string; name: string; subcategory_id: string }> = [];\n\n  interface BeforeAfterData {\n    id: string;\n    treatment_id: string;\n    before_image_url: string;\n    after_image_url: string;\n    caption: string | null;\n    patient_age: number | null;\n    patient_gender: string | null;\n    treatment_count: number | null;\n    treatment_period: string | null;\n    is_published: number;\n  }\n\n  async function loadData() {\n    try {\n      // \u30AB\u30C6\u30B4\u30EA\u4E00\u89A7\u53D6\u5F97\n      const catRes = await fetch('/api/categories');\n      const catData = await catRes.json();\n      categories = catData.categories || [];\n      populateCategories();\n\n      // \u75C7\u4F8B\u5199\u771F\u30C7\u30FC\u30BF\u53D6\u5F97\n      const res = await fetch(`/api/before-afters/${beforeAfterId}`);\n      if (!res.ok) {\n        throw new Error('\u75C7\u4F8B\u5199\u771F\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093');\n      }\n      const data = await res.json();\n      const beforeAfter = data.before_after as BeforeAfterData;\n\n      // \u6CBB\u7642ID\u304B\u3089\u30AB\u30C6\u30B4\u30EA\u30FB\u30B5\u30D6\u30AB\u30C6\u30B4\u30EA\u3092\u53D6\u5F97\uFF08\u7C21\u6613\u7248\uFF09\n      // TODO: treatment_id\u304B\u3089category_id, subcategory_id\u3092\u53D6\u5F97\u3059\u308BAPI\u304C\u5FC5\u8981\n      await loadTreatmentsForEdit(beforeAfter.treatment_id);\n\n      // \u30D5\u30A9\u30FC\u30E0\u306B\u5024\u3092\u8A2D\u5B9A\n      populateForm(beforeAfter);\n\n      // \u30D5\u30A9\u30FC\u30E0\u3092\u8868\u793A\n      document.getElementById('loadingMessage')?.classList.add('hidden');\n      const form = document.getElementById('beforeAfterForm');\n      if (form) {\n        form.classList.remove('hidden');\n      }\n    } catch (error) {\n      console.error('\u30C7\u30FC\u30BF\u8AAD\u307F\u8FBC\u307F\u30A8\u30E9\u30FC:', error);\n      const loadingMsg = document.getElementById('loadingMessage');\n      if (loadingMsg) {\n        loadingMsg.innerHTML = `<p class=\"text-red-500\">\u30C7\u30FC\u30BF\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${error instanceof Error ? error.message : 'Unknown error'}</p>`;\n      }\n    }\n  }\n\n  async function loadTreatmentsForEdit(treatmentId: string) {\n    // TODO: treatment_id\u304B\u3089treatment\u60C5\u5831\u3092\u53D6\u5F97\u3057\u3066\u3001subcategory_id\u3092\u53D6\u5F97\n    // \u73FE\u5728\u306F\u7C21\u6613\u7684\u306B\u5168\u65BD\u8853\u304B\u3089\u8A72\u5F53\u3092\u63A2\u3059\n    const select = document.getElementById('treatmentSelect') as HTMLSelectElement;\n    if (select) {\n      select.value = treatmentId;\n    }\n  }\n\n  function populateCategories() {\n    const select = document.getElementById('categorySelect') as HTMLSelectElement;\n    if (select) {\n      select.innerHTML = '<option value=\"\">\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044</option>' +\n        categories.map(cat => `<option value=\"${cat.id}\">${cat.name}</option>`).join('');\n    }\n  }\n\n  function populateForm(data: BeforeAfterData) {\n    (document.getElementById('beforeAfterId') as HTMLInputElement).value = data.id;\n    (document.getElementById('treatmentSelect') as HTMLSelectElement).value = data.treatment_id;\n    (document.getElementById('beforeImageUrl') as HTMLInputElement).value = data.before_image_url;\n    (document.getElementById('afterImageUrl') as HTMLInputElement).value = data.after_image_url;\n    \n    const beforePreview = document.getElementById('beforePreview') as HTMLImageElement;\n    if (beforePreview) {\n      beforePreview.src = data.before_image_url;\n      beforePreview.classList.remove('hidden');\n    }\n    const afterPreview = document.getElementById('afterPreview') as HTMLImageElement;\n    if (afterPreview) {\n      afterPreview.src = data.after_image_url;\n      afterPreview.classList.remove('hidden');\n    }\n    \n    (document.getElementById('caption') as HTMLTextAreaElement).value = data.caption || '';\n    if (data.patient_age) {\n      (document.getElementById('patientAge') as HTMLInputElement).value = data.patient_age.toString();\n    }\n    if (data.patient_gender) {\n      (document.getElementById('patientGender') as HTMLSelectElement).value = data.patient_gender;\n    }\n    if (data.treatment_count) {\n      (document.getElementById('treatmentCount') as HTMLInputElement).value = data.treatment_count.toString();\n    }\n    if (data.treatment_period) {\n      (document.getElementById('treatmentPeriod') as HTMLInputElement).value = data.treatment_period;\n    }\n    (document.getElementById('isPublished') as HTMLInputElement).checked = data.is_published === 1;\n  }\n\n  function updateImagePreview(inputId: string, previewId: string) {\n    const input = document.getElementById(inputId) as HTMLInputElement;\n    const preview = document.getElementById(previewId) as HTMLImageElement;\n    \n    input?.addEventListener('input', () => {\n      const url = input.value;\n      if (url && preview) {\n        preview.src = url;\n        preview.classList.remove('hidden');\n      }\n    });\n  }\n\n  document.addEventListener('DOMContentLoaded', () => {\n    loadData();\n\n    updateImagePreview('beforeImageUrl', 'beforePreview');\n    updateImagePreview('afterImageUrl', 'afterPreview');\n\n    const form = document.getElementById('beforeAfterForm') as HTMLFormElement;\n    \n    form?.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(form);\n      \n      const data = {\n        treatment_id: formData.get('treatment'),\n        before_image_url: formData.get('beforeImageUrl'),\n        after_image_url: formData.get('afterImageUrl'),\n        caption: formData.get('caption') || null,\n        patient_age: formData.get('patientAge') ? Number(formData.get('patientAge')) : null,\n        patient_gender: formData.get('patientGender') || null,\n        treatment_count: formData.get('treatmentCount') ? Number(formData.get('treatmentCount')) : null,\n        treatment_period: formData.get('treatmentPeriod') || null,\n        is_published: formData.get('isPublished') === 'on',\n        sort_order: 0\n      };\n\n      try {\n        const res = await fetch(`/api/before-afters/${beforeAfterId}`, {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(data),\n        });\n\n        if (res.ok) {\n          alert('\u66F4\u65B0\u3057\u307E\u3057\u305F');\n          window.location.href = '/before-afters';\n        } else {\n          const error = await res.json();\n          alert(`\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${error.message || 'Unknown error'}`);\n        }\n      } catch (error) {\n        console.error('\u66F4\u65B0\u30A8\u30E9\u30FC:', error);\n        alert('\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F');\n      }\n    });\n  });\n})();<\/script>"], ["", " <script>(function(){", "\n  let categories: Array<{ id: string; name: string }> = [];\n  let subcategories: Array<{ id: string; name: string; category_id: string }> = [];\n  let treatments: Array<{ id: string; name: string; subcategory_id: string }> = [];\n\n  interface BeforeAfterData {\n    id: string;\n    treatment_id: string;\n    before_image_url: string;\n    after_image_url: string;\n    caption: string | null;\n    patient_age: number | null;\n    patient_gender: string | null;\n    treatment_count: number | null;\n    treatment_period: string | null;\n    is_published: number;\n  }\n\n  async function loadData() {\n    try {\n      // \u30AB\u30C6\u30B4\u30EA\u4E00\u89A7\u53D6\u5F97\n      const catRes = await fetch('/api/categories');\n      const catData = await catRes.json();\n      categories = catData.categories || [];\n      populateCategories();\n\n      // \u75C7\u4F8B\u5199\u771F\u30C7\u30FC\u30BF\u53D6\u5F97\n      const res = await fetch(\\`/api/before-afters/\\${beforeAfterId}\\`);\n      if (!res.ok) {\n        throw new Error('\u75C7\u4F8B\u5199\u771F\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093');\n      }\n      const data = await res.json();\n      const beforeAfter = data.before_after as BeforeAfterData;\n\n      // \u6CBB\u7642ID\u304B\u3089\u30AB\u30C6\u30B4\u30EA\u30FB\u30B5\u30D6\u30AB\u30C6\u30B4\u30EA\u3092\u53D6\u5F97\uFF08\u7C21\u6613\u7248\uFF09\n      // TODO: treatment_id\u304B\u3089category_id, subcategory_id\u3092\u53D6\u5F97\u3059\u308BAPI\u304C\u5FC5\u8981\n      await loadTreatmentsForEdit(beforeAfter.treatment_id);\n\n      // \u30D5\u30A9\u30FC\u30E0\u306B\u5024\u3092\u8A2D\u5B9A\n      populateForm(beforeAfter);\n\n      // \u30D5\u30A9\u30FC\u30E0\u3092\u8868\u793A\n      document.getElementById('loadingMessage')?.classList.add('hidden');\n      const form = document.getElementById('beforeAfterForm');\n      if (form) {\n        form.classList.remove('hidden');\n      }\n    } catch (error) {\n      console.error('\u30C7\u30FC\u30BF\u8AAD\u307F\u8FBC\u307F\u30A8\u30E9\u30FC:', error);\n      const loadingMsg = document.getElementById('loadingMessage');\n      if (loadingMsg) {\n        loadingMsg.innerHTML = \\`<p class=\"text-red-500\">\u30C7\u30FC\u30BF\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F: \\${error instanceof Error ? error.message : 'Unknown error'}</p>\\`;\n      }\n    }\n  }\n\n  async function loadTreatmentsForEdit(treatmentId: string) {\n    // TODO: treatment_id\u304B\u3089treatment\u60C5\u5831\u3092\u53D6\u5F97\u3057\u3066\u3001subcategory_id\u3092\u53D6\u5F97\n    // \u73FE\u5728\u306F\u7C21\u6613\u7684\u306B\u5168\u65BD\u8853\u304B\u3089\u8A72\u5F53\u3092\u63A2\u3059\n    const select = document.getElementById('treatmentSelect') as HTMLSelectElement;\n    if (select) {\n      select.value = treatmentId;\n    }\n  }\n\n  function populateCategories() {\n    const select = document.getElementById('categorySelect') as HTMLSelectElement;\n    if (select) {\n      select.innerHTML = '<option value=\"\">\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044</option>' +\n        categories.map(cat => \\`<option value=\"\\${cat.id}\">\\${cat.name}</option>\\`).join('');\n    }\n  }\n\n  function populateForm(data: BeforeAfterData) {\n    (document.getElementById('beforeAfterId') as HTMLInputElement).value = data.id;\n    (document.getElementById('treatmentSelect') as HTMLSelectElement).value = data.treatment_id;\n    (document.getElementById('beforeImageUrl') as HTMLInputElement).value = data.before_image_url;\n    (document.getElementById('afterImageUrl') as HTMLInputElement).value = data.after_image_url;\n    \n    const beforePreview = document.getElementById('beforePreview') as HTMLImageElement;\n    if (beforePreview) {\n      beforePreview.src = data.before_image_url;\n      beforePreview.classList.remove('hidden');\n    }\n    const afterPreview = document.getElementById('afterPreview') as HTMLImageElement;\n    if (afterPreview) {\n      afterPreview.src = data.after_image_url;\n      afterPreview.classList.remove('hidden');\n    }\n    \n    (document.getElementById('caption') as HTMLTextAreaElement).value = data.caption || '';\n    if (data.patient_age) {\n      (document.getElementById('patientAge') as HTMLInputElement).value = data.patient_age.toString();\n    }\n    if (data.patient_gender) {\n      (document.getElementById('patientGender') as HTMLSelectElement).value = data.patient_gender;\n    }\n    if (data.treatment_count) {\n      (document.getElementById('treatmentCount') as HTMLInputElement).value = data.treatment_count.toString();\n    }\n    if (data.treatment_period) {\n      (document.getElementById('treatmentPeriod') as HTMLInputElement).value = data.treatment_period;\n    }\n    (document.getElementById('isPublished') as HTMLInputElement).checked = data.is_published === 1;\n  }\n\n  function updateImagePreview(inputId: string, previewId: string) {\n    const input = document.getElementById(inputId) as HTMLInputElement;\n    const preview = document.getElementById(previewId) as HTMLImageElement;\n    \n    input?.addEventListener('input', () => {\n      const url = input.value;\n      if (url && preview) {\n        preview.src = url;\n        preview.classList.remove('hidden');\n      }\n    });\n  }\n\n  document.addEventListener('DOMContentLoaded', () => {\n    loadData();\n\n    updateImagePreview('beforeImageUrl', 'beforePreview');\n    updateImagePreview('afterImageUrl', 'afterPreview');\n\n    const form = document.getElementById('beforeAfterForm') as HTMLFormElement;\n    \n    form?.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(form);\n      \n      const data = {\n        treatment_id: formData.get('treatment'),\n        before_image_url: formData.get('beforeImageUrl'),\n        after_image_url: formData.get('afterImageUrl'),\n        caption: formData.get('caption') || null,\n        patient_age: formData.get('patientAge') ? Number(formData.get('patientAge')) : null,\n        patient_gender: formData.get('patientGender') || null,\n        treatment_count: formData.get('treatmentCount') ? Number(formData.get('treatmentCount')) : null,\n        treatment_period: formData.get('treatmentPeriod') || null,\n        is_published: formData.get('isPublished') === 'on',\n        sort_order: 0\n      };\n\n      try {\n        const res = await fetch(\\`/api/before-afters/\\${beforeAfterId}\\`, {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(data),\n        });\n\n        if (res.ok) {\n          alert('\u66F4\u65B0\u3057\u307E\u3057\u305F');\n          window.location.href = '/before-afters';\n        } else {\n          const error = await res.json();\n          alert(\\`\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F: \\${error.message || 'Unknown error'}\\`);\n        }\n      } catch (error) {\n        console.error('\u66F4\u65B0\u30A8\u30E9\u30FC:', error);\n        alert('\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F');\n      }\n    });\n  });\n})();<\/script>"])), renderComponent($$result, "Layout", $$Layout, {}, { "default": async ($$result2) => renderTemplate` ${maybeRenderHead()}<div class="max-w-4xl mx-auto space-y-6"> <div> <a href="/before-afters" class="text-accent hover:underline">← 症例写真管理に戻る</a> <h2 class="text-3xl font-bold mt-4">症例写真編集</h2> </div> <div id="loadingMessage" class="bg-white rounded-lg shadow p-8 text-center"> <p class="text-gray-500">データを読み込み中...</p> </div> <form class="bg-white rounded-lg shadow p-6 space-y-6 hidden" id="beforeAfterForm"> <input type="hidden" name="id" id="beforeAfterId"> <!-- 基本情報 --> <div> <h3 class="text-xl font-semibold mb-4">基本情報</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"> <div> <label class="block text-sm font-medium mb-1">カテゴリ</label> <select name="category" id="categorySelect" class="w-full px-4 py-2 border rounded-lg" required> <option value="">選択してください</option> </select> </div> <div> <label class="block text-sm font-medium mb-1">サブカテゴリ</label> <select name="subcategory" id="subcategorySelect" class="w-full px-4 py-2 border rounded-lg"> <option value="">選択してください</option> </select> </div> <div class="md:col-span-2"> <label class="block text-sm font-medium mb-1">施術 <span class="text-red-500">*</span></label> <select name="treatment" id="treatmentSelect" class="w-full px-4 py-2 border rounded-lg" required> <option value="">選択してください</option> </select> </div> </div> </div> <!-- 画像 --> <div> <h3 class="text-xl font-semibold mb-4">画像 <span class="text-red-500">*</span></h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div> <label class="block text-sm font-medium mb-2">施術前画像URL</label> <input type="url" name="beforeImageUrl" id="beforeImageUrl" class="w-full px-4 py-2 border rounded-lg" required> <div class="mt-2 aspect-square bg-gray-100 rounded overflow-hidden"> <img id="beforePreview" src="" alt="施術前プレビュー" class="w-full h-full object-cover hidden"> </div> </div> <div> <label class="block text-sm font-medium mb-2">施術後画像URL</label> <input type="url" name="afterImageUrl" id="afterImageUrl" class="w-full px-4 py-2 border rounded-lg" required> <div class="mt-2 aspect-square bg-gray-100 rounded overflow-hidden"> <img id="afterPreview" src="" alt="施術後プレビュー" class="w-full h-full object-cover hidden"> </div> </div> </div> </div> <!-- 詳細情報 --> <div> <h3 class="text-xl font-semibold mb-4">詳細情報</h3> <div class="space-y-4"> <div> <label class="block text-sm font-medium mb-1">説明文</label> <textarea name="caption" id="caption" rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea> </div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4"> <div> <label class="block text-sm font-medium mb-1">患者年齢</label> <input type="number" name="patientAge" id="patientAge" min="0" max="150" class="w-full px-4 py-2 border rounded-lg"> </div> <div> <label class="block text-sm font-medium mb-1">性別</label> <select name="patientGender" id="patientGender" class="w-full px-4 py-2 border rounded-lg"> <option value="">選択してください</option> <option value="男性">男性</option> <option value="女性">女性</option> <option value="その他">その他</option> </select> </div> <div> <label class="block text-sm font-medium mb-1">施術回数</label> <input type="number" name="treatmentCount" id="treatmentCount" min="1" class="w-full px-4 py-2 border rounded-lg"> </div> <div> <label class="block text-sm font-medium mb-1">施術期間</label> <input type="text" name="treatmentPeriod" id="treatmentPeriod" class="w-full px-4 py-2 border rounded-lg"> </div> </div> </div> </div> <!-- 公開設定 --> <div> <h3 class="text-xl font-semibold mb-4">公開設定</h3> <div class="flex items-center gap-4"> <label class="flex items-center gap-2 cursor-pointer"> <input type="checkbox" name="isPublished" id="isPublished" class="w-4 h-4 text-accent border-gray-300 rounded"> <span>公開する</span> </label> </div> </div> <!-- アクション --> <div class="flex justify-end gap-4 pt-4 border-t"> <a href="/before-afters" class="px-6 py-2 border rounded-lg hover:bg-gray-50 transition">
キャンセル
</a> <button type="submit" class="px-6 py-2 bg-accent text-white rounded-lg hover:bg-accent-light transition">
更新
</button> </div> </form> </div> ` }), defineScriptVars({ beforeAfterId: id }));
}, "/Users/iguchiyuuta/Dev/ledian_clinic/apps/internal-site/src/pages/before-afters/[id]/edit.astro", void 0);

const $$file = "/Users/iguchiyuuta/Dev/ledian_clinic/apps/internal-site/src/pages/before-afters/[id]/edit.astro";
const $$url = "/before-afters/[id]/edit";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$Edit,
  file: $$file,
  prerender,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
