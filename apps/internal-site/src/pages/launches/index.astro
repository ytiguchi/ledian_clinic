---
import Layout from '../../components/Layout.astro';
---

<Layout>
  <div class="launches-page">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <div class="header-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path>
            <path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path>
            <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path>
            <path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path>
          </svg>
        </div>
      <div>
        <h1 class="page-title">ç™ºå£²äºˆå®šå•†å“</h1>
          <p class="page-subtitle">æ–°å•†å“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç®¡ç†</p>
        </div>
      </div>
      <a href="/launches/new" class="btn-add">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        æ–°è¦å•†å“ã‚’è¿½åŠ 
      </a>
    </div>

    <!-- Stats Overview -->
    <div class="stats-overview" id="statsOverview">
      <div class="stat-card" data-status="">
        <div class="stat-icon all">ğŸ“¦</div>
        <div class="stat-content">
          <span class="stat-value" id="statAll">-</span>
          <span class="stat-label">ã™ã¹ã¦</span>
        </div>
      </div>
      <div class="stat-card" data-status="planning">
        <div class="stat-icon planning">ğŸ’¡</div>
        <div class="stat-content">
          <span class="stat-value" id="statPlanning">-</span>
          <span class="stat-label">ä¼ç”»ä¸­</span>
        </div>
      </div>
      <div class="stat-card" data-status="pricing">
        <div class="stat-icon pricing">ğŸ’°</div>
        <div class="stat-content">
          <span class="stat-value" id="statPricing">-</span>
          <span class="stat-label">æ–™é‡‘æ±ºå®šä¸­</span>
        </div>
      </div>
      <div class="stat-card" data-status="training">
        <div class="stat-icon training">ğŸ“š</div>
        <div class="stat-content">
          <span class="stat-value" id="statTraining">-</span>
          <span class="stat-label">ç ”ä¿®ä¸­</span>
        </div>
      </div>
      <div class="stat-card" data-status="ready">
        <div class="stat-icon ready">âœ…</div>
        <div class="stat-content">
          <span class="stat-value" id="statReady">-</span>
          <span class="stat-label">ç™ºå£²æº–å‚™</span>
        </div>
      </div>
      <div class="stat-card" data-status="launched">
        <div class="stat-icon launched">ğŸ‰</div>
        <div class="stat-content">
          <span class="stat-value" id="statLaunched">-</span>
          <span class="stat-label">ç™ºå£²æ¸ˆã¿</span>
        </div>
      </div>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-section">
      <div class="filter-tabs">
        <button class="filter-tab active" data-status="">
          <span class="tab-dot"></span>
          ã™ã¹ã¦
        </button>
        <button class="filter-tab" data-status="planning">ä¼ç”»ä¸­</button>
        <button class="filter-tab" data-status="pricing">æ–™é‡‘æ±ºå®šä¸­</button>
        <button class="filter-tab" data-status="protocol">ãƒ—ãƒ­ãƒˆã‚³ãƒ«</button>
        <button class="filter-tab" data-status="training">ç ”ä¿®ä¸­</button>
        <button class="filter-tab" data-status="ready">ç™ºå£²æº–å‚™</button>
        <button class="filter-tab" data-status="launched">ç™ºå£²æ¸ˆã¿</button>
      </div>
    </div>

    <!-- Pipeline Board -->
    <div class="pipeline-board" id="pipelineBoard">
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <span>èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>
    </div>
  </div>
</Layout>

<style>
  .launches-page {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    max-width: 1400px;
  }

  /* Page Header */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1.5rem;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .header-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
  }

  .page-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--color-text);
    margin: 0;
    letter-spacing: -0.02em;
  }

  .page-subtitle {
    font-size: 0.9375rem;
    color: var(--color-text-muted);
    margin: 0.25rem 0 0;
  }

  .btn-add {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.875rem 1.5rem;
    background: linear-gradient(135deg, var(--color-accent) 0%, #c99a45 100%);
    color: var(--color-primary);
    border: none;
    border-radius: 12px;
    font-size: 0.9375rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 16px rgba(212, 168, 83, 0.3);
  }

  .btn-add:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 24px rgba(212, 168, 83, 0.4);
  }

  /* Stats Overview */
  .stats-overview {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1rem;
  }

  .stat-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border-light);
    border-radius: 16px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .stat-card:hover {
    border-color: var(--color-accent);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
  }

  .stat-card.active {
    border-color: var(--color-accent);
    background: linear-gradient(135deg, rgba(212, 168, 83, 0.08) 0%, rgba(212, 168, 83, 0.02) 100%);
  }

  .stat-icon {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .stat-icon.all { background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%); }
  .stat-icon.planning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
  .stat-icon.pricing { background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%); }
  .stat-icon.training { background: linear-gradient(135deg, #c7d2fe 0%, #a5b4fc 100%); }
  .stat-icon.ready { background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%); }
  .stat-icon.launched { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }

  .stat-content {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text);
    line-height: 1;
  }

  .stat-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    font-weight: 500;
  }

  /* Filter Section */
  .filter-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border-light);
  }

  .filter-tabs {
    display: flex;
    gap: 0.375rem;
    flex-wrap: wrap;
  }

  .filter-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: transparent;
    border: none;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .filter-tab:hover {
    background: var(--color-bg-hover);
    color: var(--color-text);
  }

  .filter-tab.active {
    background: var(--color-primary);
    color: white;
  }

  .tab-dot {
    width: 6px;
    height: 6px;
    background: currentColor;
    border-radius: 50%;
    opacity: 0.6;
  }

  /* Pipeline Board */
  .pipeline-board {
    display: grid;
    gap: 1.25rem;
    min-height: 200px;
  }

  /* Loading State */
  .loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 3rem;
    color: var(--color-text-muted);
  }

  .loading-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--color-border);
    border-top-color: var(--color-accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Launch Card - Modern Design */
  .launch-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border-light);
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    text-decoration: none;
    color: inherit;
  }

  .launch-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border-color: var(--color-accent);
  }

  /* Status specific accent border */
  .launch-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--status-color, #e5e7eb);
    opacity: 0.8;
  }

  .launch-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .launch-title-wrap {
    flex: 1;
    min-width: 0;
  }

  .launch-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--color-text);
    margin: 0;
    line-height: 1.4;
    letter-spacing: -0.01em;
  }

  .launch-owner {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    margin-top: 0.5rem;
    padding: 0.25rem 0.625rem;
    background: var(--color-bg-hover);
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-text-secondary);
  }

  .launch-status {
    padding: 0.375rem 0.75rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 700;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Status Colors */
  .status-planning { 
    background: #f3f4f6; color: #374151; 
    --status-color: #9ca3af;
  }
  .status-pricing { 
    background: #fef3c7; color: #92400e;
    --status-color: #f59e0b;
  }
  .status-protocol { 
    background: #dbeafe; color: #1e40af;
    --status-color: #3b82f6;
  }
  .status-training { 
    background: #e0e7ff; color: #3730a3;
    --status-color: #6366f1;
  }
  .status-ready { 
    background: #d1fae5; color: #065f46;
    --status-color: #10b981;
  }
  .status-launched { 
    background: #10b981; color: white;
    --status-color: #10b981;
  }
  .status-cancelled { 
    background: #fee2e2; color: #991b1b;
    --status-color: #ef4444;
  }

  .launch-meta {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .meta-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.625rem;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.8125rem;
    color: var(--color-text-secondary);
    font-weight: 500;
  }

  .meta-chip.price {
    background: #fffbeb;
    border-color: #fde68a;
    color: #92400e;
    font-weight: 600;
  }

  /* Progress Section */
  .progress-section {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 12px;
    border: 1px solid #f1f5f9;
  }

  .progress-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }

  .progress-title {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-text-muted);
  }

  .progress-value {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--color-text-secondary);
  }

  .progress-bar {
    height: 6px;
    background: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--color-accent);
    border-radius: 3px;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* System Badges */
  .system-badges {
    display: flex;
    gap: 0.5rem;
  }

  .system-badge {
    flex: 1;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 700;
    transition: all 0.2s;
    border: 1px solid transparent;
  }

  .system-badge.registered {
    background: #d1fae5;
    color: #065f46;
    border-color: #a7f3d0;
  }

  .system-badge.pending {
    background: #f1f5f9;
    color: #94a3b8;
    border-color: #e2e8f0;
  }

  /* Footer */
  .card-footer {
    margin-top: auto;
    padding-top: 1rem;
    border-top: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .view-details {
    color: var(--color-accent);
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    transition: gap 0.2s;
  }

  .launch-card:hover .view-details {
    gap: 0.5rem;
  }

  .launch-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 0.8125rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .launch-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
  }

  /* Empty State */
  .empty-state {
    grid-column: 1 / -1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    text-align: center;
  }

  .empty-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
  }

  .empty-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.5rem;
  }

  .empty-desc {
    font-size: 0.9375rem;
    color: var(--color-text-muted);
    margin-bottom: 1.5rem;
  }

  .empty-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--color-accent);
    color: var(--color-primary);
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .empty-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(212, 168, 83, 0.3);
  }

  /* Responsive */
  @media (min-width: 768px) {
    .pipeline-board {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1200px) {
    .pipeline-board {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 1024px) {
    .stats-overview {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
      align-items: stretch;
    }

    .btn-add {
      justify-content: center;
    }

    .stats-overview {
      grid-template-columns: repeat(2, 1fr);
    }

    .filter-tabs {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding-bottom: 0.5rem;
    }

    .filter-tabs::-webkit-scrollbar {
      display: none;
    }

    .launch-card {
      padding: 1.25rem;
    }
  }
</style>

<script>
  interface Launch {
    id: number;
    name: string;
    description: string | null;
    status: string;
    target_launch_date: string | null;
    owner_name: string | null;
    category_name: string | null;
    planned_price_taxed: number | null;
    total_tasks: number;
    completed_tasks: number;
    web_registered_at: string | null;
    smaregi_registered_at: string | null;
    medical_force_registered_at: string | null;
  }

  let allLaunches: Launch[] = [];
  let launches: Launch[] = [];
  let selectedStatus = '';

  const statusLabels: Record<string, string> = {
    planning: 'ä¼ç”»ä¸­',
    pricing: 'æ–™é‡‘æ±ºå®šä¸­',
    protocol: 'ãƒ—ãƒ­ãƒˆã‚³ãƒ«',
    training: 'ç ”ä¿®ä¸­',
    ready: 'ç™ºå£²æº–å‚™',
    launched: 'ç™ºå£²æ¸ˆã¿',
    cancelled: 'ä¸­æ­¢'
  };

  async function loadLaunches() {
    try {
      const res = await fetch('/api/product-launches');
      const data = await res.json();
      
      if (data.error) {
        showError(data.message || data.error);
        return;
      }
      
      allLaunches = data.launches || [];
      updateStats();
      filterLaunches();
    } catch (error) {
      console.error('Error loading launches:', error);
      showError('èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  }

  function updateStats() {
    const counts: Record<string, number> = {
      '': allLaunches.length,
      planning: 0,
      pricing: 0,
      protocol: 0,
      training: 0,
      ready: 0,
      launched: 0
    };

    allLaunches.forEach(l => {
      if (counts[l.status] !== undefined) counts[l.status]++;
    });

    document.getElementById('statAll')!.textContent = String(counts['']);
    document.getElementById('statPlanning')!.textContent = String(counts.planning);
    document.getElementById('statPricing')!.textContent = String(counts.pricing);
    document.getElementById('statTraining')!.textContent = String(counts.training);
    document.getElementById('statReady')!.textContent = String(counts.ready);
    document.getElementById('statLaunched')!.textContent = String(counts.launched);
  }

  function filterLaunches() {
    if (selectedStatus) {
      launches = allLaunches.filter(l => l.status === selectedStatus);
    } else {
      launches = [...allLaunches];
    }
    renderBoard();
  }

  function renderBoard() {
    const board = document.getElementById('pipelineBoard');
    if (!board) return;

    if (launches.length === 0) {
      board.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ“¦</div>
          <h3 class="empty-title">ç™ºå£²äºˆå®šå•†å“ãŒã‚ã‚Šã¾ã›ã‚“</h3>
          <p class="empty-desc">${selectedStatus ? 'é¸æŠã—ãŸæ¡ä»¶ã«è©²å½“ã™ã‚‹å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“' : 'æ–°ã—ã„å•†å“ã‚’è¿½åŠ ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†'}</p>
          <a href="/launches/new" class="empty-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            æ–°è¦å•†å“ã‚’è¿½åŠ 
          </a>
        </div>
      `;
      return;
    }

    board.innerHTML = launches.map(launch => {
      const progress = launch.total_tasks > 0 
        ? Math.round((launch.completed_tasks / launch.total_tasks) * 100) 
        : 0;
      
      return `
        <a href="/launches/${launch.id}/edit" class="launch-card" style="--status-color: var(--${launch.status}-color, #e5e7eb); text-decoration: none;">
          <div class="launch-header">
            <div class="launch-title-wrap">
              <h3 class="launch-title">${escapeHtml(launch.name)}</h3>
              ${launch.owner_name ? `
                <span class="launch-owner">
                  <span class="owner-icon">ğŸ‘¤</span>
                  ${escapeHtml(launch.owner_name)}
                </span>
              ` : ''}
            </div>
            <span class="launch-status status-${launch.status}">
              ${statusLabels[launch.status] || launch.status}
            </span>
          </div>
          
          <div class="launch-meta">
            ${launch.target_launch_date ? `
              <span class="meta-chip">
                <span class="meta-icon">ğŸ“…</span>
                ${formatDate(launch.target_launch_date)}
              </span>
            ` : ''}
            ${launch.planned_price_taxed ? `
              <span class="meta-chip price">
                <span class="meta-icon">ğŸ’°</span>
                Â¥${launch.planned_price_taxed.toLocaleString()}
              </span>
            ` : ''}
          </div>

          <div class="progress-section">
            <div class="progress-header">
              <span class="progress-title">ã‚¿ã‚¹ã‚¯é€²æ—</span>
              <span class="progress-value">${launch.completed_tasks}/${launch.total_tasks}</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${progress}%"></div>
            </div>
          </div>

          <div class="system-badges">
            <span class="system-badge ${launch.web_registered_at ? 'registered' : 'pending'}" title="WEB">
              ${launch.web_registered_at ? 'âœ“' : 'W'}
            </span>
            <span class="system-badge ${launch.smaregi_registered_at ? 'registered' : 'pending'}" title="ã‚¹ãƒãƒ¬ã‚¸">
              ${launch.smaregi_registered_at ? 'âœ“' : 'S'}
            </span>
            <span class="system-badge ${launch.medical_force_registered_at ? 'registered' : 'pending'}" title="ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ãƒ•ã‚©ãƒ¼ã‚¹">
              ${launch.medical_force_registered_at ? 'âœ“' : 'M'}
            </span>
          </div>

          <div class="card-footer">
            <span class="view-details">
              è©³ç´°ã‚’è¦‹ã‚‹
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </span>
            ${launch.status === 'ready' ? `
              <button onclick="event.preventDefault(); event.stopPropagation(); openLaunchModal(${launch.id})" class="launch-btn">
                ğŸ‰ ç™ºå£²ã™ã‚‹
              </button>
            ` : ''}
          </div>
        </a>
      `;
    }).join('');
  }

  function formatDate(dateStr: string): string {
    const date = new Date(dateStr);
    const y = date.getFullYear();
    const m = date.getMonth() + 1;
    const d = date.getDate();
    return `${y}/${m}/${d}`;
  }

  function escapeHtml(text: string): string {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function showError(message: string) {
    const board = document.getElementById('pipelineBoard');
    if (board) {
      board.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">âš ï¸</div>
          <h3 class="empty-title" style="color: var(--color-error);">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
          <p class="empty-desc">${escapeHtml(message)}</p>
        </div>
      `;
    }
  }

  function openLaunchModal(id: number) {
    window.location.href = `/launches/${id}/edit?action=launch`;
  }

  function setActiveFilter(status: string) {
    selectedStatus = status;
    
    // Update filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.classList.toggle('active', (tab as HTMLElement).dataset.status === status);
    });

    // Update stat cards
    document.querySelectorAll('.stat-card').forEach(card => {
      card.classList.toggle('active', (card as HTMLElement).dataset.status === status);
    });

    filterLaunches();
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadLaunches();

    // Filter tab click
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        setActiveFilter((tab as HTMLElement).dataset.status || '');
      });
    });

    // Stat card click
    document.querySelectorAll('.stat-card').forEach(card => {
      card.addEventListener('click', () => {
        setActiveFilter((card as HTMLElement).dataset.status || '');
      });
    });
  });

  (window as any).openLaunchModal = openLaunchModal;
</script>

