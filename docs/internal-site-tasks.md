# Internal Site 開発タスク

社内管理サイト（料金編集、メニュー管理、データエクスポートなど）

## 🎯 目標

社内スタッフが料金・メニュー・キャンペーンを簡単に管理できるWebアプリ

---

## 📋 Phase 1: 基盤構築

### ✅ 1-1. Astroプロジェクト初期化
- [ ] Astroプロジェクト作成
- [ ] 基本的なディレクトリ構造
- [ ] TypeScript設定
- [ ] Tailwind CSS統合
- [ ] 開発サーバー起動確認

### ✅ 1-2. レイアウト・デザインシステム
- [ ] 基本レイアウト（ヘッダー・サイドバー・メイン）
- [ ] ナビゲーション（メニュー一覧）
- [ ] デザインシステム（カラー・タイポグラフィ）
- [ ] レスポンシブ対応

### ✅ 1-3. D1統合
- [ ] D1スキーマ確認・調整（PostgreSQL → D1）
- [ ] API Routes（Pages Functions）作成
- [ ] データ取得API実装
- [ ] エラーハンドリング

---

## 📋 Phase 2: 料金管理機能

### ✅ 2-1. 料金表一覧ページ
- [ ] カテゴリ別表示
- [ ] 検索・フィルター機能
- [ ] ソート機能（価格・更新日など）
- [ ] ページネーション
- [ ] キャンペーン価格のハイライト表示

### ✅ 2-2. 料金プラン編集フォーム
- [ ] プラン作成フォーム
- [ ] プラン編集フォーム（既存データ読み込み）
- [ ] 価格入力（税抜・税込自動計算）
- [ ] 原価情報入力
- [ ] バリデーション
- [ ] 保存API（D1へのINSERT/UPDATE）

### ✅ 2-3. 一括編集機能
- [ ] 複数プランの一括選択
- [ ] 一括価格変更（パーセント/固定額）
- [ ] 一括原価率変更

---

## 📋 Phase 3: キャンペーン管理

### ✅ 3-1. キャンペーン一覧ページ
- [ ] キャンペーン一覧表示（期間・状態付き）
- [ ] キャンペーン作成ボタン
- [ ] 公開/非公開切り替え

### ✅ 3-2. キャンペーン作成・編集フォーム
- [ ] 基本情報（タイトル・説明・期間）
- [ ] 対象プラン選択（複数選択可）
- [ ] 割引タイプ選択（パーセント/固定額/特別価格）
- [ ] 割引値入力
- [ ] 優先度設定
- [ ] プレビュー（適用後の価格表示）
- [ ] 保存API

### ✅ 3-3. キャンペーン適用・解除
- [ ] 期間中自動適用ロジック
- [ ] 手動適用/解除機能
- [ ] キャンペーン価格の自動計算

---

## 📋 Phase 4: メニュー・コンテンツ管理

### ✅ 4-1. 施術一覧ページ
- [ ] カテゴリ別施術一覧
- [ ] 施術詳細モーダル/ページ
- [ ] 施術作成ボタン

### ✅ 4-2. 施術詳細編集ページ
- [ ] 基本情報（名前・説明・タグライン）
- [ ] スペック情報（施術時間・ダウンタイムなど）
- [ ] お悩み・効果・部位タグ設定
- [ ] 施術フロー編集
- [ ] FAQ編集
- [ ] 注意事項編集
- [ ] 画像アップロード（将来対応）

---

## 📋 Phase 5: データエクスポート

### ✅ 5-1. CSVエクスポート
- [ ] 料金表CSVダウンロード
- [ ] 全データCSVダウンロード
- [ ] カテゴリ別CSV

### ✅ 5-2. PDFエクスポート
- [ ] 料金表PDF生成
- [ ] 施術詳細PDF
- [ ] 印刷向けレイアウト

---

## 📋 Phase 6: 認証・認可

### ✅ 6-1. Cloudflare Access統合
- [ ] Access設定確認
- [ ] 認証状態確認（Functions middleware）
- [ ] 未認証時のリダイレクト

### ✅ 6-2. 権限管理（将来対応）
- [ ] ロールベースアクセス制御
- [ ] 編集権限の制限

---

## 📋 Phase 7: 運用機能

### ✅ 7-1. データ同期
- [ ] PostgreSQL → D1同期スクリプト
- [ ] 手動同期ボタン
- [ ] 同期履歴・ログ

### ✅ 7-2. プレビュー機能
- [ ] 一般サイトプレビュー（編集前後の比較）
- [ ] Bot用プレビュー
- [ ] カウンセリング用プレビュー

### ✅ 7-3. 履歴管理
- [ ] 変更履歴（更新日時・更新者）
- [ ] 差分表示
- [ ] ロールバック機能（将来対応）

---

## 🚀 優先順位

**最優先（MVP）:**
1. Astroプロジェクト初期化
2. 基本レイアウト
3. 料金表一覧（閲覧のみ）
4. 料金プラン編集フォーム（1件編集）

**次フェーズ:**
5. キャンペーン管理
6. 一括編集
7. CSVエクスポート

**将来拡張:**
8. PDFエクスポート
9. 履歴管理
10. 権限管理

