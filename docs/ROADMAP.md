# ロードマップ（いつか）

このドキュメントは **運用・意思決定のための最短ルート**です。  
詳細な技術計画や過去の議論は `docs/INDEX.md` から辿れます。

---

## 次の大型プロジェクト: 公開サイト再構築 🚀

**internal-site を CMS として活用し、ledianclinic.jp を Cloudflare Pages + D1 で再構築する計画**

| 項目 | 内容 |
|------|------|
| 目標 | https://ledianclinic.jp/ を internal-site と同じ D1 データベースで運用 |
| 工数 | 4-6週間（フルタイム1人） |
| 技術 | Astro + Cloudflare Pages + D1（internal-siteと統一） |
| メリット | コンテンツ一元管理、リアルタイム更新、運用コスト削減 |

**詳細:** [公開サイト構築計画](./PUBLIC_SITE_PLAN.md)

---

## ビジョンに向けたリファクタリング・タスクリスト

公開サイト再構築のビジョンに向けて、internal-site 側の整理を先に進めるためのタスク。

### データ/モデル整備

- [ ] 公開サイトで必要なデータ項目の棚卸し（施術/料金/キャンペーン/お知らせ/BeforeAfter）
- [ ] `is_published`/公開フラグの運用ルールを全テーブルで統一
- [ ] 既存データの欠損/不整合チェックと補正方針の決定
- [ ] 公開向けクエリに必要なインデックス確認・追加方針

**優先度**
- P0: 公開サイトで必要なデータ項目の棚卸し
- P0: `is_published`/公開フラグの運用ルールを全テーブルで統一
- P1: 既存データの欠損/不整合チェックと補正方針の決定
- P1: 公開向けクエリに必要なインデックス確認・追加方針

### API整備（read-only想定）

- [ ] 公開サイト用の読み取りAPI方針を決定（共通read-only or 直接D1）
- [ ] APIレスポンス/エラー形式の統一（`{ error, fields? }`）
- [ ] 入力バリデーションの共通化（正規化/数値変換/必須チェック）
- [ ] 公開向けフィルタ（`is_published`）の共通化

**優先度**
- P0: 公開サイト用の読み取りAPI方針を決定
- P0: 公開向けフィルタ（`is_published`）の共通化
- P1: APIレスポンス/エラー形式の統一
- P1: 入力バリデーションの共通化

---

## P0の具体タスク（最初にやること）

### データ棚卸し（P0）
- [ ] 公開サイトのページ一覧を確定（トップ/施術一覧・詳細/料金/キャンペーン/アクセス/お知らせ/BeforeAfter）
- [ ] （暫定）ページ一覧:
  - トップ
  - 施術一覧
  - 施術詳細
  - 料金表
  - キャンペーン
  - アクセス/クリニック情報
  - お知らせ一覧/詳細
  - 記事/コラム一覧/詳細
  - 症例一覧/詳細（Before/After）
  - よくある質問（FAQ）
  - 予約/問い合わせ導線（フォーム or 外部リンク）
- [ ] 各ページの必須データ項目を列挙（D1のテーブル/カラム対応表を作成）
- [ ] 既存D1の対応状況を確認（不足項目・NULL許容の整理）

### 公開フラグ統一（P0）
- [ ] 公開フラグの名称を決定（例: `is_published`）と対象テーブルの洗い出し
- [ ] 公開/非公開の運用ルール（管理画面の挙動）を定義
- [ ] 公開サイト側のフィルタ条件を定義（例: `WHERE is_published = 1`）

### スキーマ統合（P0）
- [ ] 統合スキーマの正本を決定（`database/schema_d1_full.sql` を基準に統一）
- [ ] 主キー型の統一（`product_launches` 系: INTEGER vs TEXT を決める）
- [ ] 参照キーの統一（`treatment_plans`/content系: `treatment_id` vs `subcategory_id`）
- [ ] 症例テーブルの名称統一（`before_afters` vs `treatment_before_afters`）
- [ ] 記事コンテンツ（`articles`）の追加に向けたマイグレーション作成
- [ ] 統一方針ドキュメント作成（`docs/SCHEMA_UNIFICATION.md`）

### 画像/アセット

- [ ] R2の公開URL設計と命名規則（画像/動画）
- [ ] 画像最適化ルールの決定（Transform/サイズ/品質）

**優先度**
- P1: R2の公開URL設計と命名規則
- P2: 画像最適化ルールの決定

### キャッシュ/パフォーマンス

- [ ] キャッシュ戦略の方針決定（SSG/ISR/KV/Cache API）
- [ ] 公開サイト向け `Cache-Control` のルール整理

**優先度**
- P1: キャッシュ戦略の方針決定
- P2: 公開サイト向け `Cache-Control` のルール整理

### ルーティング/URL設計

- [ ] URL/slug命名規則の統一（施術/カテゴリ/キャンペーン）
- [ ] 旧サイトからのURL互換/リダイレクト方針

**優先度**
- P1: URL/slug命名規則の統一
- P2: 旧サイトからのURL互換/リダイレクト方針

---

## いつか（Someday）

- 外部システム連携（POS / カルテ）
- データ分析・レポート
- 認証・認可の強化（ロール/操作ログ）
- メディア（画像/動画）管理の統一・CMS移行

---

## 参考リンク（詳細）

- 全体の古い/詳細ロードマップ（要整理）: `docs/COMPREHENSIVE_ROADMAP.md`
- 作業メモ/タスク候補: `docs/tasks.md`
- 内部サイト 進捗（更新が古い可能性）: `docs/internal-site-progress.md`
