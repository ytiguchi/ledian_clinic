# タスクリスト

最終更新: 2024-12-26

直近の作業をブレイクダウンしています。完了したらチェックを入れ、必要に応じてチケット化してください。

---

## ✅ 最近完了したタスク

### 症例写真(BeforeAfter)管理
- [x] 症例写真一覧ページの表示修正
- [x] 編集ビューのTypeScript構文エラー修正
- [x] R2への画像移行スクリプト作成 (`scripts/migrate_images_to_r2.py`)
- [x] caption正規化スクリプト作成 (`scripts/migrate_before_afters.py`)
- [x] 構造化データへの変換（部位、施術回数、リスク等）

### 料金管理
- [x] 料金一覧ページのインライン編集モーダル実装
- [x] 料金新規作成ページのデザイン改善
- [x] 施術詳細ページでの料金編集機能
- [x] URLパラメータによる施術自動選択 (`/pricing/new?treatment=ID`)

---

## 🔥 優先タスク（P0）

### 公開サイト準備

- [ ] 公開サイトのページ一覧を確定（トップ/施術一覧・詳細/料金/キャンペーン/アクセス/お知らせ/記事/症例）
- [ ] 各ページの必須データ項目を列挙（D1のテーブル/カラム対応表を作成）
- [ ] 既存D1の対応状況を確認（不足項目・NULL許容の整理）

### 公開フラグ統一

- [ ] 公開フラグの名称を決定（例: `is_published`）と対象テーブルの洗い出し
- [ ] 公開/非公開の運用ルール（管理画面の挙動）を定義
- [ ] 公開サイト側のフィルタ条件を定義（例: `WHERE is_published = 1`）

### スキーマ統合

- [ ] 統合スキーマの正本を決定（`database/schema_d1_full.sql` を基準に統一）
- [ ] 主キー型の統一（`product_launches` 系: INTEGER vs TEXT を決める）
- [ ] 参照キーの統一（`treatment_plans`/content系: `treatment_id` vs `subcategory_id`）
- [ ] 症例テーブルの名称統一（`before_afters` vs `treatment_before_afters`）
- [ ] 統一方針ドキュメント作成（`docs/SCHEMA_UNIFICATION.md`）

---

## 📋 次にやること（P1）

### API整備（read-only想定）

- [ ] 公開サイト用の読み取りAPI方針を決定（共通read-only or 直接D1）
- [ ] APIレスポンス/エラー形式の統一（`{ error, fields? }`）
- [ ] 入力バリデーションの共通化（正規化/数値変換/必須チェック）
- [ ] 公開向けフィルタ（`is_published`）の共通化

### 画像/アセット

- [ ] R2の公開URL設計と命名規則（画像/動画）
  - 現在: `https://pub-7fb3b78717844555a19c9c9ccae5f2f9.r2.dev`
- [ ] 画像最適化ルールの決定（Transform/サイズ/品質）
- [ ] 画像アップロードUIの実装

### キャッシュ/パフォーマンス

- [ ] キャッシュ戦略の方針決定（SSG/ISR/KV/Cache API）
- [ ] 公開サイト向け `Cache-Control` のルール整理

### ルーティング/URL設計

- [ ] URL/slug命名規則の統一（施術/カテゴリ/キャンペーン）
- [ ] 旧サイトからのURL互換/リダイレクト方針

---

## 🗓 近々やること（P2）

- [ ] Web: 料金表の掲載形式（カード/テーブル/FAQ）を決め、必要なフィールドを洗い出し
- [ ] 社内Bot: インテント一覧と優先応答（料金/施術説明/予約フロー）を設計
- [ ] カウンセリング: 禁忌事項と同意事項の共通リストを `data/shared/` にまとめる
- [ ] 記事コンテンツ（`articles`）の追加に向けたマイグレーション作成
- [ ] データエクスポート機能（CSV/PDF）

---

## 🌌 いつか（Someday）

- 外部システム連携（POS / カルテ）
- データ分析・レポート
- 認証・認可の強化（ロール/操作ログ）
- メディア（画像/動画）管理の統一・CMS移行

---

## 📝 メモ/アイデア

- チャネル別の語調・長さを `shared/` でプリセット化すると量産が楽
- 画像メタ（ファイル名、撮影条件、ALT テキスト）も `shared/` に置き、後から CMS に載せ替え可能にする
- internal をマスターとして public へマスク/抽出する同期フローを CI で定常化
