# タスクリスト

直近の作業をブレイクダウンしています。完了したらチェックを入れ、必要に応じてチケット化してください。

## 優先タスク
- [ ] `data/catalog/` のフィールド定義とテンプレート作成（カテゴリ、サブカテゴリ、施術）。
- [ ] `data/pricing/` のフィールド定義とテンプレート作成（プラン種別、税込/税抜、原価情報）。
- [ ] 代表的な施術1件（例: ウルトラセルZi）で正規化データとチャネル別コピーをサンプル投入。
- [ ] バリデーション/変換スクリプトの要件整理を `scripts/` 用 README に起票。
- [ ] シード/同期スクリプトの骨組み（`scripts/seed_from_yaml`, `scripts/mask_for_public`）を作成。

## 公開サイト再構築（リファクタリング前提）

### データ/モデル整備
- [ ] 公開サイトで必要なデータ項目の棚卸し（施術/料金/キャンペーン/お知らせ/BeforeAfter）
- [ ] `is_published`/公開フラグの運用ルールを全テーブルで統一
- [ ] 既存データの欠損/不整合チェックと補正方針の決定
- [ ] 公開向けクエリに必要なインデックス確認・追加方針

#### P0の具体タスク
- [ ] 公開サイトのページ一覧を確定（トップ/施術一覧・詳細/料金/キャンペーン/アクセス/お知らせ/記事/症例）
- [ ] 各ページの必須データ項目を列挙（D1のテーブル/カラム対応表を作成）
- [ ] 既存D1の対応状況を確認（不足項目・NULL許容の整理）
- [ ] 公開フラグの名称を決定（例: `is_published`）と対象テーブルの洗い出し
- [ ] 公開/非公開の運用ルール（管理画面の挙動）を定義
- [ ] 公開サイト側のフィルタ条件を定義（例: `WHERE is_published = 1`）
- [ ] 統合スキーマの正本を決定（`database/schema_d1_full.sql` を基準に統一）
- [ ] 主キー型の統一（`product_launches` 系: INTEGER vs TEXT を決める）
- [ ] 参照キーの統一（`treatment_plans`/content系: `treatment_id` vs `subcategory_id`）
- [ ] 症例テーブルの名称統一（`before_afters` vs `treatment_before_afters`）
- [ ] 記事コンテンツ（`articles`）の追加に向けたマイグレーション作成
- [ ] 統一方針ドキュメント作成（`docs/SCHEMA_UNIFICATION.md`）

### API整備（read-only想定）
- [ ] 公開サイト用の読み取りAPI方針を決定（共通read-only or 直接D1）
- [ ] APIレスポンス/エラー形式の統一（`{ error, fields? }`）
- [ ] 入力バリデーションの共通化（正規化/数値変換/必須チェック）
- [ ] 公開向けフィルタ（`is_published`）の共通化

### 画像/アセット
- [ ] R2の公開URL設計と命名規則（画像/動画）
- [ ] 画像最適化ルールの決定（Transform/サイズ/品質）

### キャッシュ/パフォーマンス
- [ ] キャッシュ戦略の方針決定（SSG/ISR/KV/Cache API）
- [ ] 公開サイト向け `Cache-Control` のルール整理

### ルーティング/URL設計
- [ ] URL/slug命名規則の統一（施術/カテゴリ/キャンペーン）
- [ ] 旧サイトからのURL互換/リダイレクト方針

## 近々やること
- [ ] Web: 料金表の掲載形式（カード/テーブル/FAQ）を決め、必要なフィールドを洗い出し。
- [ ] 社内Bot: インテント一覧と優先応答（料金/施術説明/予約フロー）を設計。
- [ ] カウンセリング: 禁忌事項と同意事項の共通リストを `data/shared/` にまとめる。
- [ ] DB 反映: `schema.sql` に合わせたインポート用 CSV/SQL の生成手順を作成。

## メモ/アイデア
- チャネル別の語調・長さを `shared/` でプリセット化すると量産が楽。
- 画像メタ（ファイル名、撮影条件、ALT テキスト）も `shared/` に置き、後から CMS に載せ替え可能にする。
- internal をマスターとして public へマスク/抽出する同期フローを CI で定常化。
