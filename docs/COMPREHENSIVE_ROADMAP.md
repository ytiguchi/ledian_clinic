# 内部サイト 包括的ロードマップ

## 目的の再確認

### 1. データ管理
- メニュー・料金の一元管理
- キャンペーン管理
- 症例写真管理
- トレーニング（スタッフ約30名向け）

### 2. データの出口（最終的な用途）

#### 短期（3-6ヶ月）
- **デザイナー向けAPI**: 公開WEBサイト構築用
- **データエクスポート**: CSV/PDF/JSON

#### 中期（6-12ヶ月）
- **POSシステム連携**: 料金・メニュー情報
- **カルテシステム連携**: 施術情報、症例情報

#### 長期（12ヶ月以降）
- **その他システム連携**: 必要に応じて追加
- **データ分析**: 経営判断用のデータ分析

## 全体ロードマップ

```
┌─────────────────────────────────────────────────────────────┐
│ Phase 0: 基盤整備（完了）                                    │
│ - 内部サイト構築（Astro + D1）                               │
│ - 基本的なCRUD機能                                           │
│ - マイグレーションシステム                                    │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│ Phase 1: データ構造の拡張・正規化（現在〜3ヶ月）             │
│                                                              │
│ 1.1 施術詳細情報の完全実装                                   │
│   - treatment_details の完全実装                             │
│   - treatment_flows（施術フロー）                            │
│   - treatment_cautions（注意事項）                           │
│   - treatment_faqs（FAQ）                                    │
│                                                              │
│ 1.2 メディア管理の正規化                                     │
│   - media テーブルの作成                                     │
│   - 画像・動画の統一管理                                     │
│                                                              │
│ 1.3 タグシステムの実装                                       │
│   - tags, treatment_tags の実装                             │
│   - タグカテゴリの管理                                       │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│ Phase 2: 料金・原価管理の拡張（3-6ヶ月）                    │
│                                                              │
│ 2.1 原価管理の詳細化                                         │
│   - 原価の内訳管理                                           │
│   - 原価履歴管理                                             │
│                                                              │
│ 2.2 価格履歴管理                                             │
│   - price_history テーブル                                   │
│                                                              │
│ 2.3 社販管理の拡張                                           │
│   - 社販価格の詳細管理                                       │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│ Phase 3: デザイナー向けAPI実装（3-6ヶ月）                   │
│                                                              │
│ 3.1 API基盤の構築                                            │
│   - API Key認証                                              │
│   - /api/v1/* エンドポイント                                 │
│                                                              │
│ 3.2 必須エンドポイントの実装                                 │
│   - GET /api/v1/categories                                   │
│   - GET /api/v1/treatments/{id}                              │
│   - GET /api/v1/plans                                        │
│   - GET /api/v1/campaigns                                    │
│                                                              │
│ 3.3 APIドキュメントの整備                                    │
│   - OpenAPI/Swagger仕様書                                    │
│   - サンプルコード                                            │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│ Phase 4: トレーニング機能（6-9ヶ月）                        │
│                                                              │
│ 4.1 お知らせ機能                                             │
│   - announcements テーブル                                   │
│   - 既読管理                                                 │
│                                                              │
│ 4.2 FAQ機能                                                  │
│   - general_faqs テーブル                                    │
│   - 検索機能                                                 │
│                                                              │
│ 4.3 マニュアル機能                                           │
│   - training_manuals テーブル                                │
│   - ファイル管理                                             │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│ Phase 5: データエクスポート機能（6-9ヶ月）                  │
│                                                              │
│ 5.1 基本エクスポート                                         │
│   - CSV/PDF/JSON出力                                         │
│                                                              │
│ 5.2 システム別フォーマット                                   │
│   - POSシステム向けフォーマット                              │
│   - カルテシステム向けフォーマット                            │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│ Phase 6: 外部システム連携（9-12ヶ月）                       │
│                                                              │
│ 6.1 PostgreSQL連携                                           │
│   - D1 → PostgreSQL データ同期                               │
│                                                              │
│ 6.2 POSシステム連携                                          │
│   - API経由でのデータ提供                                    │
│   - 定期的な同期処理                                         │
│                                                              │
│ 6.3 カルテシステム連携                                       │
│   - API経由でのデータ提供                                    │
│   - 施術情報の連携                                           │
└─────────────────────────────────────────────────────────────┘
```

## 各Phaseの詳細

### Phase 1: データ構造の拡張・正規化

**目標**: デザイナーが公開サイトで必要なデータを完全に管理できるようにする

**実装項目**:
1. 施術詳細情報の完全実装
2. メディア管理の正規化
3. タグシステムの実装

**成果物**:
- 拡張されたデータベーススキーマ
- マイグレーションファイル
- データ投入スクリプト

### Phase 2: 料金・原価管理の拡張

**目標**: 経営判断に必要な詳細な原価・価格情報を管理

**実装項目**:
1. 原価管理の詳細化
2. 価格履歴管理
3. 社販管理の拡張

### Phase 3: デザイナー向けAPI実装

**目標**: デザイナーが本番サイトを構築できるAPIを提供

**実装項目**:
1. API Key認証
2. RESTful APIエンドポイント
3. APIドキュメント

**成果物**:
- `/api/v1/*` エンドポイント
- API仕様書
- サンプルコード

### Phase 4: トレーニング機能

**目標**: スタッフが新しい情報を確認できる機能を提供

**実装項目**:
1. お知らせ機能
2. FAQ機能
3. マニュアル機能

### Phase 5: データエクスポート機能

**目標**: 各種システムにデータを提供できる形式でエクスポート

**実装項目**:
1. 基本エクスポート（CSV/PDF/JSON）
2. システム別フォーマット

### Phase 6: 外部システム連携

**目標**: POS、カルテシステムなどと連携

**実装項目**:
1. PostgreSQL連携
2. POSシステム連携
3. カルテシステム連携

## 技術的な考慮事項

### データベース

- **内部管理**: D1（Cloudflare SQLite互換）
- **本番・連携**: PostgreSQL
- **同期**: D1 → PostgreSQL の同期処理

### API設計

- **RESTful**: 標準的なREST API
- **バージョニング**: `/api/v1/` でバージョン管理
- **認証**: API Key認証
- **ドキュメント**: OpenAPI/Swagger

### データ構造

- **正規化**: 第3正規形以上を目指す
- **拡張性**: 将来的な要件追加に対応
- **パフォーマンス**: 適切なインデックスとクエリ最適化

## 成功指標

### Phase 1完了時
- 施術詳細情報が完全に管理できる
- デザイナーが必要なデータが揃っている

### Phase 3完了時
- デザイナーがAPIを使って本番サイトを構築できる
- APIドキュメントが整備されている

### Phase 6完了時
- POSシステムと連携できている
- カルテシステムと連携できている
- データの一元管理ができている

## リスクと対策

### リスク1: データ構造の変更が既存機能に影響

**対策**:
- 段階的な移行
- 後方互換性の維持
- 十分なテスト

### リスク2: APIパフォーマンスの低下

**対策**:
- 適切なインデックス設計
- キャッシュの活用
- クエリ最適化

### リスク3: 外部システム連携の複雑化

**対策**:
- 標準的なAPI設計
- 十分なドキュメント
- 段階的な実装

## 関連ドキュメント

- [データ正規化ロードマップ](./DATA_NORMALIZATION_ROADMAP.md)
- [デザイナー向けAPI仕様](./API_FOR_DESIGNER.md)
- [システム統合ガイド](./DESIGNER_INTEGRATION.md)
- [API実装計画](./API_IMPLEMENTATION_PLAN.md)
- [内部サイトの目的](./INTERNAL_SITE_PURPOSE.md)

