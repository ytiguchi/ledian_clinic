# ã‚¢ãƒ—ãƒªæ§‹æˆï¼ˆç¤¾å†…å‘ã‘/ä¸€èˆ¬å‘ã‘ã®2ã‚µã‚¤ãƒˆé‹ç”¨ï¼‰

å…±é€šã® D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚½ãƒ¼ã‚¹ã«ã€2ã¤ã®ã‚µã‚¤ãƒˆã‚’ç®¡ç†ã—ã¾ã™ã€‚

- ä¸€èˆ¬å‘ã‘ã‚µã‚¤ãƒˆ: `apps/public-site/`ï¼ˆCloudflare Pagesã€ledianclinic.jpï¼‰
- ç¤¾å†…å‘ã‘ã‚µã‚¤ãƒˆ: `apps/internal-site/`ï¼ˆCloudflare Access + Lineworks SSOã§ä¿è­·ã€admin.ledianclinic.jpï¼‰

> **ğŸ“‹ å®Ÿè£…è¨ˆç”»:** [å…¬é–‹ã‚µã‚¤ãƒˆæ§‹ç¯‰è¨ˆç”»](./PUBLIC_SITE_PLAN.md)

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare D1                        â”‚
â”‚                   (å…±æœ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
         â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   internal-site     â”‚       â”‚   public-site       â”‚
â”‚   (ç®¡ç†ç”»é¢/CMS)     â”‚       â”‚  ledianclinic.jp    â”‚
â”‚   èªè¨¼ä»˜ããƒ»CRUD     â”‚       â”‚  ä¸€èˆ¬å…¬é–‹ãƒ»èª­ã¿å–ã‚Š  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ–¹é‡

- `apps/public-site/`: å¤–éƒ¨å…¬é–‹ã™ã‚‹UIã€‚LP/æ–™é‡‘è¡¨ãªã©ã‚’è¡¨ç¤ºã€‚ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã¯ã“ã®ä¸­ã§å®Œçµï¼ˆä¾‹: `apps/public-site/dist/`ï¼‰ã€‚Pages ã® `pages_build_output_dir` ã‚’ã“ã“ã«åˆã‚ã›ã‚‹ã€‚
- `apps/internal-site/`: ç¤¾å†…é–²è¦§ç”¨UIã€‚æ–™é‡‘ç·¨é›†ãƒ“ãƒ¥ãƒ¼ã€Bot/ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ç”¨ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€CSV/PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãªã©ã€‚Cloudflare Access ãƒãƒªã‚¢å‰æã€‚
- åŒæ–¹ã¨ã‚‚ **åŒä¸€ã® D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** ã‚’å‚ç…§ã—ã€R2ï¼ˆç”»åƒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ã‚‚å…±æœ‰ã™ã‚‹ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¾‹
```
data/ (YAMLæ­£è¦åŒ–)
  â”œ catalog/
  â”œ pricing/
  â”œ content/{web|bot|counseling}/
  â”” shared/
   â†“ scripts/seed_from_yaml (ç”Ÿæˆ)
   â†’ D1 (DB)  # Pages Functions ã‹ã‚‰å‚ç…§
   â†’ outputs/json  # é™çš„JSONã¨ã—ã¦é…ä¿¡ã™ã‚‹å ´åˆ
```

## ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆææ¡ˆï¼‰
- ä¸¡ã‚µã‚¤ãƒˆã¨ã‚‚ Astro ã‚’æ¡ç”¨ï¼ˆè»½é‡ã§é™çš„/å‹•çš„ã®ä¸¡æ–¹ã«å¯¾å¿œã—ã‚„ã™ã„ï¼‰ã€‚
- public-site: Astro + CSRæœ€å°é™ã€å‡ºåŠ› `apps/public-site/dist`ï¼ˆ`wrangler.toml` ã‚‚ã“ã“ã«åˆã‚ã›æ¸ˆã¿ï¼‰ã€‚
- internal-site: Astro + Cloudflare Access/Lineworks SSO ã§ä¿è­·ã€‚`wrangler.internal.toml` ã‚’åˆ¥é€”ç”¨æ„ã—ã¦ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ãƒ‘ã‚¹ã‚’å®šç¾©ã™ã‚‹æƒ³å®šã€‚

## æ¨å¥¨ãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤å˜ä½
- `apps/public-site`: GitHub Actions â†’ Cloudflare Pages deploy (prod/stg)ã€‚Astro build â†’ `dist`ã€‚
- `apps/internal-site`: åŒæ§˜ã« Pages deploy ã ãŒã€Access ã§ä¿è­·ã€‚internal ã¯ prod ã®ã¿é‹ç”¨ï¼ˆpreview database ãªã—ï¼‰ã€‚

## ä»Šå¾Œã®ToDoï¼ˆå®Ÿè£…å‰ï¼‰

- [x] ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ±ºå®š: **Astro**ï¼ˆä¸¡ã‚µã‚¤ãƒˆå…±é€šï¼‰
- [ ] `apps/public-site/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆãƒ»AstroåˆæœŸåŒ–
- [ ] `wrangler.jsonc` ã§ D1/R2 ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¨­å®šï¼ˆinternal-siteã¨åŒã˜IDã‚’ä½¿ç”¨ï¼‰
- [ ] æ—¢å­˜ã‚µã‚¤ãƒˆï¼ˆledianclinic.jpï¼‰ã®HTML/CSSç§»æ¤
- [ ] CI ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ `apps/*` ã”ã¨ã« build â†’ deploy ã‚’é †åºåŒ–

**è©³ç´°ãªå®Ÿè£…è¨ˆç”»:** [å…¬é–‹ã‚µã‚¤ãƒˆæ§‹ç¯‰è¨ˆç”»](./PUBLIC_SITE_PLAN.md)
